<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Confession THPT ‚Ä¢ ·∫®n danh chia s·∫ª</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
    }

    :root {
      --bg: #020617;
      --bg-soft: #0b1220;
      --card: rgba(15, 23, 42, 0.95);
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --accent-strong: #4ade80;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2937;
      --danger: #f97373;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.9);
      --radius-xl: 18px;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at 0% 0%, #1e293b 0, #020617 40%, #020617 100%);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
    }

    /* TOP NAV */
    .nav {
      height: 60px;
      border-bottom: 1px solid var(--border-subtle);
      backdrop-filter: blur(16px);
      background: linear-gradient(to right,
        rgba(15, 23, 42, 0.92),
        rgba(15, 23, 42, 0.8)
      );
      padding: 0 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-logo {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #4ade80, #22c55e 60%, #15803d 100%);
      box-shadow: 0 0 18px rgba(34, 197, 94, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      color: #022c22;
    }

    .nav-title-main {
      font-weight: 600;
      letter-spacing: 0.03em;
      font-size: 15px;
    }

    .nav-title-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .nav-badge {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 6px 10px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .dot-online {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    /* MAIN LAYOUT */
    .main {
      flex: 1;
      padding: 18px;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto 24px auto;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.3fr);
      gap: 22px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* LEFT SIDE: HERO + RULES */
    .hero-card {
      background: radial-gradient(circle at top left,
        rgba(34, 197, 94, 0.12),
        rgba(15, 23, 42, 0.95));
      border-radius: var(--radius-xl);
      padding: 20px 20px 18px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.8);
      font-size: 11px;
      color: var(--accent-strong);
      width: fit-content;
    }

    .hero-badge span {
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      font-weight: 500;
    }

    .hero-title {
      font-size: 22px;
      font-weight: 700;
      line-height: 1.35;
    }

    .hero-title span {
      background: linear-gradient(to right, #4ade80, #a3e635);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .hero-stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 4px;
    }

    .stat-card {
      border-radius: 13px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
      padding: 8px 10px;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    .stat-value {
      margin-top: 4px;
      font-size: 18px;
      font-weight: 600;
    }

    .stat-tag {
      margin-top: 2px;
      font-size: 11px;
      color: var(--accent-strong);
    }

    .hero-rules {
      margin-top: 6px;
      padding: 10px 11px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed rgba(75, 85, 99, 0.9);
    }

    .hero-rules-title {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #e5e7eb;
    }

    .hero-rules ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .hero-rules li {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      gap: 6px;
    }

    .hero-rules li::before {
      content: "‚Ä¢";
      color: var(--accent-strong);
    }

    /* RIGHT SIDE: FORM */
    .form-card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: 18px 18px 16px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 4px;
    }

    .form-title {
      font-size: 16px;
      font-weight: 600;
    }

    .form-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .form-chip {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 11px;
      color: var(--text-muted);
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
      margin-bottom: 6px;
    }

    .field-label {
      font-size: 12px;
      color: #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .field-label span {
      font-size: 11px;
      color: var(--text-muted);
    }

    .field-input,
    .field-textarea,
    .field-select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 13px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    .field-textarea {
      min-height: 110px;
      resize: vertical;
      max-height: 230px;
    }

    .field-input::placeholder,
    .field-textarea::placeholder {
      color: #6b7280;
      font-size: 12px;
    }

    .field-input:focus,
    .field-textarea:focus,
    .field-select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.6);
      background: rgba(15, 23, 42, 1);
    }

    .field-row {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.9fr);
      gap: 10px;
    }

    @media (max-width: 600px) {
      .field-row {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .form-footer {
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .checkbox-row input {
      width: 14px;
      height: 14px;
      accent-color: var(--accent);
    }

    .char-counter {
      font-size: 11px;
      color: var(--text-muted);
    }

    .char-counter span {
      color: var(--accent-strong);
      font-weight: 500;
    }

    .btn-submit {
      border: 0;
      padding: 8px 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 0,
        #a3e635,
        #22c55e 45%,
        #16a34a 100%);
      color: #022c22;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 12px 25px rgba(22, 163, 74, 0.6);
      transition: transform 0.1s, box-shadow 0.1s, filter 0.1s;
      white-space: nowrap;
    }

    .btn-submit:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
    }

    .btn-submit:active {
      transform: translateY(0);
      box-shadow: 0 6px 16px rgba(22, 163, 74, 0.5);
    }

    .btn-submit[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-icon {
      font-size: 14px;
    }

    .error-msg {
      font-size: 11px;
      color: var(--danger);
      margin-top: 2px;
      min-height: 14px;
    }

    /* TOAST */
    .toast {
      position: fixed;
      right: 16px;
      bottom: 16px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(34, 197, 94, 0.8);
      color: var(--accent-strong);
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
      transition: opacity 0.18s, transform 0.18s;
      z-index: 50;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .toast-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.9);
    }

    /* FEED SECTION */
    .feed-section {
      margin-top: 18px;
      background: rgba(15, 23, 42, 0.92);
      border-radius: var(--radius-xl);
      padding: 14px 16px 12px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      box-shadow: var(--shadow-soft);
    }

    .feed-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
    }
     .feed-actions {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: flex-end;
    }


    .feed-title {
      font-size: 15px;
      font-weight: 600;
    }

    .feed-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .feed-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      font-size: 10px;
    }

    .feed-tag {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      color: var(--text-muted);
    }

    .confession-list {
  margin-top: 6px;
  overflow: hidden;                /* ·∫©n ph·∫ßn tr∆∞·ª£t ra ngo√†i */
  position: relative;
}

/* track ch·ª©a c√°c page */
.confession-list-track {
  display: flex;
  transition: transform 0.6s ease-in-out;
  will-change: transform;
}

/* m·ªói page l√† 1 "slide" full width, ch·ª©a t·ªëi ƒëa 6 card */
.slider-page {
  min-width: 100%;
  box-sizing: border-box;
  padding-right: 4px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 10px;
}

.auto-btn {
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.7);
  background: rgba(15, 23, 42, 0.95);
  color: #e5e7eb;
  font-size: 11px;
  padding: 5px 10px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: background 0.15s, transform 0.1s, box-shadow 0.1s;
}

.auto-btn:hover {
  background: rgba(31, 41, 55, 1);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.7);
}

.auto-btn.active {
  border-color: #22c55e;
  color: #bbf7d0;
}


    .confession-empty {
      font-size: 12px;
      color: var(--text-muted);
      padding: 8px 0;
    }

    .confession-card {
      border-radius: 14px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: radial-gradient(circle at 0 0,
        rgba(34, 197, 94, 0.07),
        rgba(15, 23, 42, 0.98));
      padding: 9px 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .confession-meta {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .badge-anon {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(75, 85, 99, 0.9);
      font-size: 10px;
    }

    .confession-target {
      font-size: 11px;
      color: var(--accent-strong);
    }

    .confession-content {
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .confession-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
      font-size: 10px;
      color: var(--text-muted);
    }

    footer {
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
      padding: 8px 12px 18px;
      border-top: 1px solid rgba(15, 23, 42, 0.8);
      background: rgba(2, 6, 23, 0.96);
    }

  </style>
</head>
<body>
  <header class="nav">
    <div class="nav-left">
      <div class="nav-logo">C</div>
      <div>
        <div class="nav-title-main">School Confession</div>
        <div class="nav-title-sub">N√≥i h·∫øt l√≤ng m√¨nh ‚Ä¢ ·∫®n danh 100%</div>
      </div>
    </div>
    <div class="nav-badge">
      <div class="dot-online"></div>
      ƒêang m·ªü submit h√¥m nay
    </div>
  </header>

  <main class="main">
    <section class="layout">
      <!-- LEFT -->
      <div class="hero-card">
        <div class="hero-badge">
          K√™nh t·ªè t√¨nh, b√≥c ph·ªët (vƒÉn minh)
          <span>#THPT</span>
        </div>
        <h1 class="hero-title">
          Vi·∫øt ƒëi·ªÅu b·∫°n kh√¥ng d√°m n√≥i<br />
          <span>Confession ·∫©n danh cho tr∆∞·ªùng b·∫°n</span>
        </h1>
        <p class="hero-subtitle">
          Chia s·∫ª t√¢m s·ª±, c·∫£m x√∫c, l·ªùi c·∫£m ∆°n, l·ªùi xin l·ªói,... m√† kh√¥ng s·ª£ b·ªã
          l·ªô danh t√≠nh. Admin s·∫Ω l·ªçc &amp; ƒëƒÉng nh·ªØng confession ph√π h·ª£p
          l√™n fanpage / nh√≥m c·ªßa tr∆∞·ªùng.
        </p>

        <div class="hero-stats">
          <div class="stat-card">
            <div class="stat-label">T√¢m s·ª± h√¥m nay</div>
            <div class="stat-value" id="stat-today">0</div>
            <div class="stat-tag">confession</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ƒê∆∞·ª£c l∆∞u c·ª•c b·ªô</div>
            <div class="stat-value" id="stat-total">0</div>
            <div class="stat-tag">tr√™n thi·∫øt b·ªã n√†y</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">·∫®n danh</div>
            <div class="stat-value">100%</div>
            <div class="stat-tag">kh√¥ng thu th·∫≠p info</div>
          </div>
        </div>

        <div class="hero-rules">
          <div class="hero-rules-title">Quy t·∫Øc nh·∫π nh√†ng tr∆∞·ªõc khi g·ª≠i üíö</div>
          <ul>
            <li>Kh√¥ng d√πng t·ª´ ng·ªØ x√∫c ph·∫°m, body shaming, k·ª≥ th·ªã.</li>
            <li>Kh√¥ng c√¥ng khai th√¥ng tin nh·∫°y c·∫£m c·ªßa ng∆∞·ªùi kh√°c.</li>
            <li>Kh√¥ng vu kh·ªëng, b·ªãa ƒë·∫∑t g√¢y ·∫£nh h∆∞·ªüng danh d·ª±.</li>
            <li>Admin c√≥ quy·ªÅn kh√¥ng ƒëƒÉng c√°c confession vi ph·∫°m.</li>
          </ul>
        </div>
      </div>

      <!-- RIGHT: FORM -->
      <form class="form-card" id="confession-form">
        <div class="form-header">
          <div>
            <div class="form-title">G·ª≠i confession ·∫©n danh</div>
            <div class="form-sub">* Admin s·∫Ω xem &amp; duy·ªát tr∆∞·ªõc khi ƒëƒÉng</div>
          </div>
          <div class="form-chip">
            üîí Kh√¥ng l∆∞u t√™n th·∫≠t
          </div>
        </div>

        <div class="field-row">
          <div class="field-group">
            <label class="field-label">
              G·ª≠i ƒë·∫øn (t√™n / l·ªõp / gi√°o vi√™n)
              <span>(kh√¥ng b·∫Øt bu·ªôc)</span>
            </label>
            <input
              type="text"
              id="target"
              class="field-input"
              placeholder="VD: B·∫°n b√†n cu·ªëi 12A2, th·∫ßy d·∫°y L√Ω, c√¥ b√°n cƒÉn-tin..."
            />
          </div>

          <div class="field-group">
            <label class="field-label">
              B·∫°n h·ªçc kh·ªëi / l·ªõp
              <span>(optional)</span>
            </label>
            <input
              type="text"
              id="grade"
              class="field-input"
              placeholder="VD: 12A2, 11 chuy√™n To√°n..."
            />
          </div>
        </div>

        <div class="field-group">
          <label class="field-label">
            N·ªôi dung confession
            <span>√çt nh·∫•t 10 k√Ω t·ª±</span>
          </label>
          <textarea
            id="content"
            class="field-textarea"
            maxlength="1000"
            placeholder="Vi·∫øt t·∫•t c·∫£ nh·ªØng g√¨ b·∫°n mu·ªën n√≥i... (t√¢m s·ª±, crush, l·ªùi c·∫£m ∆°n, l·ªùi xin l·ªói, ∆∞·ªõc m∆°, stress v√¨ thi c·ª≠, drama nh·∫π nh√†ng, v.v.)"
          ></textarea>
          <div class="error-msg" id="error-msg"></div>
        </div>

        <div class="form-footer">
          <div class="checkbox-row">
            <input type="checkbox" id="checkbox-anon" checked />
            <label for="checkbox-anon">
              G·ª≠i ·∫©n danh (kh√¥ng ghi t√™n, kh√¥ng ƒë·ªÉ l·ªô info c√° nh√¢n)
            </label>
          </div>

          <div style="display:flex; align-items:center; gap:10px;">
            <div class="char-counter">
              <span id="char-count">0</span>/1000 k√Ω t·ª±
            </div>
            <button class="btn-submit" type="submit" id="btn-submit">
              <span class="btn-icon">üìÆ</span>
              G·ª≠i confession
            </button>
          </div>
        </div>
      </form>
    </section>

    <!-- FEED (DEMO LOCAL) -->
    <section class="feed-section">
  <div class="feed-header">
    <div>
      <div class="feed-title">B·∫£ng tin confession</div>
      <div class="feed-subtitle">
        C√°c confession m·ªõi nh·∫•t s·∫Ω hi·ªÉn th·ªã theo d·∫°ng slide, m·ªói 6 box m·ªôt l·∫ßn.
      </div>
    </div>
    <div class="feed-actions">
      <div class="feed-tags">
        <div class="feed-tag">#anonymous</div>
        <div class="feed-tag">#school</div>
        <div class="feed-tag">#crush</div>
      </div>
      <button id="toggle-autoslide" class="auto-btn">
        ‚è∏ T·∫Øt auto slide
      </button>
    </div>
  </div>

  <!-- track slider -->
  <div id="confession-list" class="confession-list">
    <!-- C√°c slide-page s·∫Ω ƒë∆∞·ª£c JS render -->
  </div>
</section>

  </main>

  <div class="toast" id="toast">
    <div class="toast-dot"></div>
    <span id="toast-text">ƒê√£ g·ª≠i confession ·∫©n danh th√†nh c√¥ng!</span>
  </div>

  <footer>
    Made with üíö cho tr∆∞·ªùng b·∫°n. H√£y d√πng confession ƒë·ªÉ t·ª≠ t·∫ø h∆°n v·ªõi nhau.
  </footer>

 <script>
  (function () {
    const form = document.getElementById("confession-form");
    const targetInput = document.getElementById("target");
    const gradeInput = document.getElementById("grade");
    const contentInput = document.getElementById("content");
    const errorMsg = document.getElementById("error-msg");
    const charCount = document.getElementById("char-count");
    const btnSubmit = document.getElementById("btn-submit");
    const confessionList = document.getElementById("confession-list");
    const toast = document.getElementById("toast");
    const toastText = document.getElementById("toast-text");
    const statToday = document.getElementById("stat-today");
    const statTotal = document.getElementById("stat-total");
    const toggleAutoBtn = document.getElementById("toggle-autoslide");

    const PAGE_SIZE = 6;          // m·ªói slide 6 box
    const AUTO_INTERVAL = 8000;   // 8 gi√¢y

    let currentPage = 0;
    let pagesCount = 0;
    let autoSlide = true;
    let slideTimer = null;

    // ---- Helper: format ng√†y gi·ªù ----
    function formatDateTime(ts) {
      const date = new Date(ts);
      const dd = String(date.getDate()).padStart(2, "0");
      const mm = String(date.getMonth() + 1).padStart(2, "0");
      const yyyy = date.getFullYear();
      const hh = String(date.getHours()).padStart(2, "0");
      const min = String(date.getMinutes()).padStart(2, "0");
      return `${dd}/${mm}/${yyyy} ‚Ä¢ ${hh}:${min}`;
    }

    function isToday(ts) {
      const d = new Date(ts);
      const now = new Date();
      return (
        d.getFullYear() === now.getFullYear() &&
        d.getMonth() === now.getMonth() &&
        d.getDate() === now.getDate()
      );
    }

    function showToast(message) {
      toastText.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 2500);
    }

    function renderStats(confessions) {
      const total = confessions.length;
      const todayCount = confessions.filter((c) => isToday(c.createdAt)).length;
      statTotal.textContent = total;
      statToday.textContent = todayCount;
    }

    // ---- G·ªçi API backend ----
    async function fetchConfessionsFromServer() {
      try {
        const res = await fetch("/api/confessions");
        if (!res.ok) throw new Error("Failed to fetch");
        return await res.json();
      } catch (e) {
        console.error(e);
        return [];
      }
    }

    function stopAutoSlide() {
      if (slideTimer) {
        clearInterval(slideTimer);
        slideTimer = null;
      }
    }

    function startAutoSlide() {
      stopAutoSlide();
      if (!autoSlide || pagesCount <= 1) return;
      slideTimer = setInterval(() => {
        goToPage((currentPage + 1) % pagesCount);
      }, AUTO_INTERVAL);
    }

    function goToPage(pageIndex) {
      if (pagesCount === 0) return;
      currentPage = pageIndex;
      const track = confessionList.querySelector(".confession-list-track");
      if (!track) return;
      track.style.transform = `translateX(-${currentPage * 100}%)`;
    }

    async function renderConfessions() {
      const confessions = await fetchConfessionsFromServer();

      confessionList.innerHTML = "";

      if (confessions.length === 0) {
        const empty = document.createElement("div");
        empty.className = "confession-empty";
        empty.textContent =
          "Ch∆∞a c√≥ confession n√†o ƒë∆∞·ª£c l∆∞u tr√™n server. H√£y l√† ng∆∞·ªùi g·ª≠i t√¢m s·ª± ƒë·∫ßu ti√™n!";
        confessionList.appendChild(empty);
        pagesCount = 0;
        stopAutoSlide();
        renderStats(confessions);
        return;
      }

      // track ch·ª©a c√°c slide-page
      const track = document.createElement("div");
      track.className = "confession-list-track";
      confessionList.appendChild(track);

      // nh√≥m theo page size = 6
      const sorted = [...confessions].sort(
        (a, b) => b.createdAt - a.createdAt
      );
      const pages = [];
      for (let i = 0; i < sorted.length; i += PAGE_SIZE) {
        pages.push(sorted.slice(i, i + PAGE_SIZE));
      }
      pagesCount = pages.length;
      currentPage = 0;

      pages.forEach((pageItems) => {
        const page = document.createElement("div");
        page.className = "slider-page";

        pageItems.forEach((c) => {
          const card = document.createElement("article");
          card.className = "confession-card";

          const meta = document.createElement("div");
          meta.className = "confession-meta";

          const leftMeta = document.createElement("div");
          const anon = document.createElement("span");
          anon.className = "badge-anon";
          anon.textContent = "Ng∆∞·ªùi g·ª≠i ·∫©n danh";
          leftMeta.appendChild(anon);

          if (c.grade) {
            const grade = document.createElement("span");
            grade.style.marginLeft = "6px";
            grade.style.fontSize = "11px";
            grade.style.color = "#a5b4fc";
            grade.textContent = `‚Ä¢ Kh·ªëi / l·ªõp: ${c.grade}`;
            leftMeta.appendChild(grade);
          }

          const time = document.createElement("span");
          time.textContent = formatDateTime(c.createdAt);

          meta.appendChild(leftMeta);
          meta.appendChild(time);

          const content = document.createElement("p");
          content.className = "confession-content";
          content.textContent = c.content;

          const footer = document.createElement("div");
          footer.className = "confession-footer";

          const target = document.createElement("div");
          if (c.target) {
            const t = document.createElement("span");
            t.className = "confession-target";
            t.textContent = `G·ª≠i ƒë·∫øn: ${c.target}`;
            target.appendChild(t);
          } else {
            const t = document.createElement("span");
            t.className = "confession-target";
            t.textContent = "G·ª≠i ƒë·∫øn: (kh√¥ng ghi r√µ)";
            target.appendChild(t);
          }

          const tag = document.createElement("div");
          tag.textContent = "#pending_admin";

          footer.appendChild(target);
          footer.appendChild(tag);

          card.appendChild(meta);
          card.appendChild(content);
          card.appendChild(footer);

          page.appendChild(card);
        });

        track.appendChild(page);
      });

      // reset transform
      track.style.transform = "translateX(0%)";

      renderStats(confessions);
      startAutoSlide();
    }

    // ---- ƒê·∫øm k√Ω t·ª± ----
    function updateCharCount() {
      const len = contentInput.value.length;
      charCount.textContent = len;
    }

    contentInput.addEventListener("input", () => {
      updateCharCount();
      if (contentInput.value.length >= 10) {
        errorMsg.textContent = "";
      }
    });

    // ---- Toggle auto slide ----
    toggleAutoBtn.addEventListener("click", () => {
      autoSlide = !autoSlide;
      if (autoSlide) {
        toggleAutoBtn.textContent = "‚è∏ T·∫Øt auto slide";
        toggleAutoBtn.classList.add("active");
        startAutoSlide();
      } else {
        toggleAutoBtn.textContent = "‚ñ∂ B·∫≠t auto slide";
        toggleAutoBtn.classList.remove("active");
        stopAutoSlide();
      }
    });

    // ---- Submit form: POST /api/confessions ----
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const content = contentInput.value.trim();
      const target = targetInput.value.trim();
      const grade = gradeInput.value.trim();

      if (content.length < 10) {
        errorMsg.textContent =
          "Confession h∆°i ng·∫Øn, vi·∫øt r√µ h∆°n m·ªôt ch√∫t (‚â• 10 k√Ω t·ª±) nh√©.";
        return;
      }

      errorMsg.textContent = "";
      btnSubmit.disabled = true;

      try {
        const res = await fetch("/api/confessions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ target, grade, content }),
        });

        if (!res.ok) {
          const data = await res.json().catch(() => ({}));
          throw new Error(data.error || "G·ª≠i th·∫•t b·∫°i, th·ª≠ l·∫°i sau.");
        }

        form.reset();
        updateCharCount();
        showToast("ƒê√£ g·ª≠i confession ·∫©n danh th√†nh c√¥ng! üíö");
        await renderConfessions(); // load l·∫°i t·ª´ server
      } catch (err) {
        console.error(err);
        errorMsg.textContent =
          err.message || "C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i sau.";
      } finally {
        btnSubmit.disabled = false;
      }
    });

    // ---- Init ----
    renderConfessions();
    updateCharCount();
  })();
</script>

</body>
</html>
